<script lang="ts" context="module">
	export type Trade = {
        buy_step: number,
        buy_price: number,
        sell_step: number,
        sell_price: number,
        profit: number,
    }
</script>
<script lang="ts">
	import loader from '$lib/images/loader.svg'
	import Trades from './Trades.svelte'
	import Metrics from './Metrics.svelte';
	import Errors from './Errors.svelte'
	import { page } from '$app/stores'
	import { onMount } from 'svelte'
	import { mlflowGet } from '../../../mlflow'

	const id = $page.url.searchParams.get('id') || ''
	const stage = $page.url.searchParams.get('stage') || 'test'
	
	let isLoading = true
	let errors: Array<String> = []
	let closePrices: Array<number> = []
	let actions: Array<number> = []
	let volumes: Array<number> = []
	let trades: Array<Trade> = []
	let minMaxStep: Array<number> = []

	let closePricesTrain = [4108.37,4139.98,4386.69,9128.02,9316.42,9381.27,9680.04,9733.93,9775.53,9511.43,9068.65,9170,9179.15,8720.34,9650,8900.35,8841.18,9204.07,9575.89,9427.07,9697.72,9448.27,10200.77,9518.04,9666.24,9896.8,9789.06,9621.16,9666.3,9746.99,9782.01,9772.43,9885,9280.4,9465.13,9473.34,9687.88,9342.1,9426.02,9525.59,9465.14,9386.32,9310.23,9358.95,9294.69,9685.69,9624.89,9838.96,9296.49,9249.49,9162.21,9012,9116.35,9192.56,9138.55,9232,9086.54,9058.26,10782.99,9135.46,9069.41,9344.2,9257.39,9436.06,9232.43,9288.34,9234.03,9302.75,9242.62,10890.01,9255.85,9197.6,9133.72,9154.32,9170.28,9208.99,9160.78,9390,9518.16,9603.27,11165.41,9537.8,9700.42,9931.54,11029.96,10906.27,11100.53,11099.61,11335.46,11801.17,11071.35,11579,11219.81,11191.97,11744.91,11762.46,11594.23,11761.41,11681.68,11892.92,11392.08,11564.33,11699.99,11780,11760.54,11852.4,11911,12281.13,11945.01,11754.59,11853.55,11531.34,11662.96,4587.48,13550.05,11648.13,11748.2,11318.42,11461.43,11330.38,11526.91,11465.84,11711.16,11649.51,11921.97,16599,11388.54,10140.85,10446.25,10166.69,10256.2,10373.44,10126.65,10219.2,10336.87,10387.89,15880,10440.92,10332.83,10671.77,10785.31,10954.01,10939.99,10933.39,11080.65,10920.28,10417.22,14656.07,10529.61,10241.46,10736.32,10686.67,10728.6,10774.25,10696.12,10840.48,10776.59,10619.13,14899.98,10570.4,10542.06,10666.63,10792.21,10599.66,10666.39,10925.57,11050.64,11293.22,11369.02,16587.97,11528.25,11420.56,11417.89,11505.12,11319.32,11360.2,11503.14,11751.47,11909.99,12780.96,16349.99,12968.52,12923.07,13111.73,13028.83,13052.19,13636.17,13266.4,13455.7,13560.1,13791,16033.29,13761.5,13549.37,14023.53,14144.01,15590.02,15579.92,14818.3,15475.1,15328.41,15297.21,16334.98,15684.24,16291.86,16320.7,16070.45,15957,16713.57,17659.38,17776.12,17802.82,18655.67,17539.83,18703.8,18414.43,18368,19160.01,18719.11,17149.47,17139.52,17719.85,18184.99,19695.87,4555.14,19102.66,18764.96,19204.09,19421.9,18650.52,19147.66,19359.4,19166.9,18324.11,18541.28,18254.63,18860.02,18036.53,18808.69,19174.99,19273.14,19426.43,21335.52,22797.16,23107.39,23821.61,23455.52,18856.25,22719.71,23810.79,23232.76,23729.2,24712.47,26493.39,26281.66,27079.41,27385,28875.54,17295.2,28923.63,29331.69,32178.33,33000.05,31988.71,33949.53,36769.36,39432.28,40582.81,40088.22,16488.98,38150.02,35404.47,34051.24,37371.38,39144.5,36742.22,35994.98,35828.61,36631.27,35891.49,15492.64,35468.23,30850.13,32945.17,32078,32259.9,32254.2,32467.77,30366.15,33364.86,34252.2,13326.61,34262.88,33092.98,33526.37,35466.24,37618.87,36936.66,38290.24,39186.94,38795.69,46374.87,13300,46420.42,44807.58,47969.51,47287.6,47153.69,48577.79,47911.1,49133.45,52119.71,51552.6,13500,55906,55841.19,57408.57,54087.67,48891,49676.2,47073.73,46276.87,46106.43,45135.66,13699.34,49587.03,48440.65,50349.37,48374.09,48751.71,48882.2,50971.75,52375.17,54884.5,55851.59,4724.89,15689.01,57773.16,57221.72,61188.39,58968.31,55605.2,56900.75,58912.97,57648.16,58030.01,58102.28,15459.99,57351.56,54083.25,54340.89,52303.65,51293.78,55025.59,55817.14,55777.63,57635.47,58746.57,14182.11,58740.55,58720.44,58950.01,57051.94,58202.01,59129.99,57991.15,55953.45,58077.52,58142.54,14378.9,59769.13,60002.43,59860,63575,62959.53,63159.98,61334.8,60006.66,56150.01,55633.14,12440.01,56425,53787.63,51690.96,51125.14,50047.84,49066.77,54001.39,55011.97,54846.22,53555,13716.36,57694.27,57800.37,56578.21,57169.39,53200.01,57436.11,56393.68,57314.75,58862.05,58240.84,13380,55816.14,56670.02,49631.32,49670.97,49841.45,46762.99,46431.5,43538.04,42849.78,36690.09,14675.11,40526.64,37252.01,37449.73,34655.25,38796.29,38324.72,39241.91,38529.98,35663.49,34605.15,14919.51,35641.27,37253.81,36693.09,37568.68,39246.79,36829,35513.2,35796.31,33552.79,33380.81,15059.54,37388.05,36675.72,37331.98,35546.11,39020.57,40516.29,40144.04,38349.01,38092.97,35819.84,4834.91,16960.39,35483.72,35600.16,31608.93,32509.56,33678.07,34663.09,31584.45,32283.65,34700.34,34494.89,17069.79,35911.73,35045,33504.69,33786.55,34669.13,35286.51,33690.14,34220.01,33862.12,32875.71,16150.03,33815.81,33502.87,34258.99,33086.63,32729.77,32820.02,31880,31383.87,31520.07,31778.56,14902.54,30839.65,29790.35,32144.51,32287.83,33634.09,34258.14,35381.02,37237.6,39457.87,40019.56,14400,40016.48,42206.37,41461.83,39845.44,39147.82,38207.05,39723.18,40862.46,42836.87,44572.54,14907.09,43794.37,46253.4,45584.99,45511,44399,47800,47068.51,46973.82,45901.29,44695.95,13238.78,44705.29,46760.62,49322.47,48821.87,49239.22,49488.85,47674.01,48973.32,46843.87,49069.9,13740.01,48895.35,48767.83,46982.91,47100.89,48810.52,49246.64,49999.14,49915.64,51756.88,52663.9,14210,46863.73,46048.31,46395.14,44850.91,45173.69,46025.24,44940.73,47111.52,48121.41,47737.82,13474.99,47299.98,48292.74,47241.75,43015.62,40734.38,43543.61,44865.26,42810.57,42670.64,43160.9,4472.14,13539.93,42147.35,41026.54,41524.28,43824.1,48141.61,47634.9,48200.01,49224.94,51471.99,55315,10900,53785.22,53951.43,54949.72,54659,57471.35,55996.93,57367,57347.94,61672.42,60875.57,10988.79,61528.33,62009.84,64280.59,66001.41,62193.15,60688.22,61286.75,60852.22,63078.78,60328.81,10961.97,58413.44,60575.89,62253.71,61859.19,61299.8,60911.11,63219.99,62896.48,61395.01,60937.12,11474.98,61470.61,63273.59,67525.83,66947.66,64882.43,64774.26,64122.23,64380,65519.1,63606.74,12799.94,60058.87,60344.87,56891.62,58052.24,59707.51,58622.02,56247.18,57541.27,57138.29,58960.36,11530,53726.53,54721.03,57274.88,57776.25,56950.56,57184.07,56480.34,53601.05,49152.47,49396.33,10760.05,50441.92,50588.95,50471.19,47545.59,47140.54,49389.99,50053.9,46702.75,48343.28,48864.98,10799.18,47632.38,46131.2,46834.48,46681.23,46914.16,48889.88,48588.16,50838.81,50820,50399.66,11349.99,50775.49,50701.44,47543.74,46464.66,47120.87,46216.93,47722.65,47286.18,46446.1,45832.01,4509.08,11175.27,43451.13,43082.31,41566.48,41679.74,41864.62,41822.49,42729.29,43902.66,42560.11,43059.96,11089,43084.29,43071.66,42201.62,42352.12,41660.01,40680.91,36445.31,35071.42,36244.55,36660.35,11491,36958.32,36809.34,37160.1,37716.56,38166.84,37881.76,38466.9,38694.59,36896.36,37311.61,11879.95,41574.25,41382.59,42380.87,43839.99,44042.99,44372.72,43495.44,42373.73,42217.87,42053.66,11251,42535.94,44544.86,43873.56,40515.7,39974.44,40079.17,38386.89,37008.16,38230.33,37250.01,10237.51,38327.21,39219.17,39116.72,37699.07,43160,44421.2,43892.98,42454,39148.66,39397.96,10285.1,38420.81,37988,38730.63,41941.71,39422,38729.57,38807.36,37777.34,39671.37,39280.33,9224.52,41114,40917.9,41757.51,42201.13,41262.11,41002.25,42364.13,42882.76,43991.46,44313.16,8873.03,44511.27,46827.76,47122.21,47434.8,47067.99,45510.34,46283.49,45811,46407.35,46580.51,9199.96,45497.55,43170.47,43444.19,42252.01,42753.97,42158.85,39530.45,40074.94,41147.79,39942.38,4100.11,8184.81,40551.9,40378.71,39678.12,40801.13,41493.18,41358.19,40480.01,39709.18,39441.6,39450.13,6939.99,40426.08,38112.65,39235.72,39742.07,38596.11,37630.8,7652.14,7599,7784.02,8683.92,8533.98,8063.88,8903,8539.9,4366.47,9449.99,10000.09,10159.98,11039.55,10383.43,11153,11200.99,10437.6,9811.04,10131.04,4619.77,9694.51,9590,10324,10569.04,10326.76,10920,11039,11464.48,11515,11454,4086.29,4691.61,10716.48,9910,9271.64,9227,8770.22,9533.57,9131.34,9150,8170,8240.98,4282.8,8260,7824.8,8189.99,8600,8909.98,8885,8722.9,8898.03,8546.86,8470.15,4258.81,8134.23,7795.51,7949.3,7090.14,6840.23,6923.91,6813.01,7056,7405.21,6796.1,4130.37,6770.76,6601.39,6895.8,7018,6782.72,6843.9,6953.79,7923,7877.41,7999.01,4208.47,8355,8064.92,7885.02,8173,8278,8856.98,8915.31,8787.02,8934.01,9619.99,4163.72,8869.99,9266,8915.35,9348,9419,9246.01,9071.48,9247.84,9750,9713.99,3944.69,9864,9659.01,9365,9187.56,9310,9002.2,8400,8465.94,8679.71,8663.34,3189.02,8462,8330,8041.46,8239.81,8233.49,8526.98,8381.24,7977.11,7501.95,7575.01,3700,7457,7333.96,7338.99,7099,7461.29,7375.96,7485.01,7521.01,7640.03,7714.26,3714.95,7487,7625,7658.84,7691.08,7603.44,7491.73,6764.99,6872,6530,6292.78,4016,3699.99,6635.98,6388.9,6483.98,6449.61,6712.46,6741.21,6761.51,6718.84,6045,6149.98,4035.01,6136.97,6252,6070.78,6133.73,5853.98,6197.92,6390.07,6356.81,6615.29,6513.86,3910.04,6586.98,6529.2,6609.78,6756.98,6712.1,6662.12,6296.91,6378.07,6250.57,6214.57,3900,6251.99,6353.01,6723.35,7317.44,7381.9,7466.21,7337.53,7398.78,7394.79,7721.01,3609.99,8397.24,8175.64,7920,8188.57,8225.04,8211,8173.92,7730.93,7604.58,7525.71,3595.87,7418.78,7009.84,7024.19,6934.82,6720.06,6285,6529.79,6144.01,6232.35,6308.33,3780,6246.35,6188.08,6267.16,6311.75,6584.49,6387.96,6477.53,6254.84,6480,6360.89,3660.02,6525.01,6681.64,6733.64,6700,6908.64,7076.11,7031.22,6984.84,7011.21,7200.01,3920.75,7302.01,7263.02,7359.06,6700,6516.01,6395.54,6185.05,6250.81,6312,6294.91,3882.35,6338.62,6487.38,6476.63,6514.96,6505,6248.69,6336.45,6391.89,6492,6759.02,4040,4193,6723.05,6708,6581.39,6447.54,6465.12,6689.13,6634.58,6596.38,6626.57,6611.61,4174.5,6525.79,6510,6593.79,6635.65,6594.27,6615.26,6673.01,6656.61,6631,6252.68,4174.69,6298.01,6332.93,6339.34,6752.5,6759.27,6740.89,6618.96,6528.88,6588.4,6590.11,4378.51,6581.2,6553.51,6565.5,6528.09,6538.63,6505.6,6489.93,6344.5,6330.87,6371.93,4378.48,6410,6433.98,6387.09,6485.85,6468.99,6519.11,6578.46,6479.84,6419.99,6433.05,4380,6449.81,6453.07,6457.66,5922.41,5753.4,5655.94,5628.29,5662,4910.03,4558.86,4310,4661.07,4370,4420.61,3932.44,4085.78,3862.2,3875.21,4264.85,4295.84,4041.32,4208.59,4190.02,4161.01,3884.01,3951.64,3769.84,3508.75,3403.55,3410.93,3545.37,3432.88,4292.43,3380.39,3445,3302.06,3224.17,3211.72,3228.67,3509.08,3652.98,3662.22,4049.62,4369,3838.66,3948.91,3929.71,4008.01,3745.79,3777.74,3567.91,3839.26,3695.32,3801.91,4114.01,4423,3702.9,3797.14,3858.56,3766.78,3792.01,3770.96,3987.6,3975.45,3955.13,3966.65,4640,3585.88,3601.31,3583.13,3476.81,3626.09,3553.06,3591.84,3616.21,3594.87,3665.3,4786.95,3539.28,3526.9,3570.93,3552.82,3569.62,3565.29,3565.25,3550.84,3434.15,3411.04,4783.06,3458.18,3434.1,3462.07,3504.77,3458.11,3463.22,3471.59,3405.37,3398.4,3659.04,4821.43,3665.18,3680.06,3631.05,3631.46,3609.4,3590.56,3602.47,3618.41,3667.58,3898.6,5430,3907.79,3969.74,3937.31,3962,4117.76,3743.56,3827.92,3809.23,3818.07,3813.69,5649.98,3823,3819.93,3807.75,3715.3,3857.73,3861.84,3873.64,3864.89,3943.04,3916.82,5869.99,3871.61,3882.73,3866,3877.12,3923.76,4005.98,3981.14,3987.81,4015.53,4043.04,5709.99,3980.64,3986.93,4006.01,3992.18,3936.12,3948.55,4038.05,4027.81,4103.25,4106.97,5760.02,4103.95,4144.56,4857.29,4932.6,4898.66,5004.95,5043.89,5170.27,5236.9,5150,4316.01,5595,5308.25,5017.37,5048.01,5045.22,5131.3,5024.95,5173.72,5202.82,5258.44,5258.68,5512.06,5291.73,5256.14,5357.14,5493.31,5415,5219.9,5314.1,5295.69,5307.52,5238.14,5683.9,5320.81,5383.2,5492.87,5772.69,5829.45,5775.62,5747.79,5846.34,5987.29,6209.18,6010.01,6373.33,7076.22,6967.31,7790.71,7947.56,8169.87,7866.59,7355.26,7257.45,8148.48,6024.97,7938.15,7904.87,7628.43,7851.51,7964.87,8025.41,8614.43,8756.32,8715.64,8645.68,5950.02,8269.54,8555,8544.07,8725.98,8115.82,7687.03,7776.5,7786.7,7980.53,7893.62,5915.93,7628.13,7982.75,7884.9,8127.64,8218.54,8650,8808.7,8953.33,9313.96,9081.55,5477.03,9255.49,9517.12,10159.86,10729.5,10906.07,11056.59,11820.86,13093.8,11329.99,12400.63,5689.99,11903.13,10854.1,10624.93,10842.85,11940,11145.67,10970.73,11256.49,11406.24,12238.6,5861.77,12543.41,12108.37,11342.89,11757.22,11355.76,10174.18,10838.72,9439.59,9667.92,10627.16,4280.68,5768.83,10504.29,10740.23,10589.45,10340.31,9864.91,9763.28,9879.87,9824,9476.52,9541.54,5719.64,9507.64,9574.21,10080.53,10374.99,10523.75,10816.86,10929.23,11828.8,11481.69,11975.03,6169.98,11999.77,11879.99,11309.31,11549.97,11396.08,10892.71,10050.37,10293.93,10331.54,10216.02,6120.5,10306.78,10915.54,10760.51,10142.57,10099.88,10389.55,10134.35,10142.69,10372.25,10185.05,6463,9721,9498.44,9584.54,9587.47,9724.98,10340,10615.28,10567.02,10564.49,10298.73,6753.98,10455.88,10381.18,10303.12,10098.15,10158.33,10415.01,10342.06,10335.02,10302.01,10251.31,7019.98,10187.82,10156.99,10244.29,10168.59,9986.39,10028.87,9702.25,8493.14,8430.05,8063.73,7115.04,8177.91,8198.81,8043.82,8289.34,8292.44,8359.94,8223.96,8137.13,8126.19,7854.25,7357.09,8190.09,8168.39,8560.74,8558.03,8258.5,8300.09,8275.01,8348.2,8159.29,7991.74,7345.01,8070.58,7947.01,7948.01,8223.35,8197.27,8020,7466.62,7412.41,8655.02,9230,4337.44,6960.12,9529.93,9205.14,9407.62,9154.72,9140.85,9231.61,9289.52,9194.71,9393.35,9308.66,7064.04,9339.05,9216.2,8773.73,8809.41,9039.47,8733.27,8821.94,8777.12,8646.68,8471.73,7303,8491.02,8502.4,8187.17,8133.64,8098.01,7627.74,7268.23,7311.57,6903.28,7109.57,7079.99,7156.14,7508.52,7419.49,7739.68,7541.89,7390.89,7294.28,7292.71,7194.32,7389,6506.98,7527.47,7488.21,7510.11,7338.64,7224.13,7210,7198.08,7258.48,7064.05,7118.59,6245.05,6891.72,6623.82,7277.83,7150.3,7187.83,7132.75,7501.44,7317.09,7255.77,7204.63,5811.03,7202,7254.74,7316.14,7388.24,7246,7195.23,7200.85,6965.71,7344.96,7354.11,6465.99,7358.75,7758,8145.28,8055.98,7817.76,8197.02,8020.01,8184.98,8110.34,8810.01,6574.99,8821.41,8720.01,8913.28,8915.96,8701.7,8642.35,8736.03,8682.36,8404.52,8439,7240.06,8340.58,8615,8907.57,9374.21,9301.53,9513.21,9352.89,9384.61,9331.51,9292.24,4310.01,7864.5,9197.02,9612.04,9772,9813.73,9895.05,10151.75,9851.83,10223.08,10326.46,10229.63,7699.19,10344.36,9904.72,9917.27,9706,10164.71,9593.79,9596.42,9677.05,9650.86,9936.4,7761.94,9656.13,9315.84,8785.25,8823.21,8692.91,8523.61,8531.88,8915.24,8760.07,8750.87,8038,9054.68,9131.88,8886.66,8033.31,7929.87,7894.56,7934.52,4800,5578.6,5172.06,8212,5361.3,5028.97,5312.64,5393.04,6162.37,6208.36,6186.98,5816.19,6467.31,6744.72,8119.51,6677.43,6737.36,6359.11,6236.65,5881.42,6394.38,6410.44,6642.92,6794.09,6734.1,8205.92,6856.99,6772.78,7329.9,7197.32,7361.28,7283.54,6858.92,6876.83,6903.79,6837.91,8019.99,6868.7,6621.24,7101.94,7027.55,7248.6,7120.74,6826.83,6841.37,7125.14,7482.39,8138,7505,7538.67,7693.1,7774.62,7738.98,8778.57,8620,8826.96,8972.05,8894.16,8700.01,8871.96,9021.83,9142.92,9986.4,9800.01,9539.4,8722.77,8561.52,8810.79,9791.98]
	let actionsTrain = [0,1,2,1,2,2,1,0,2,0,0,1,0,2,1,2,0,1,0,2,2,2,1,2,0,1,0,2,0,1,2,0,2,1,0,2,1,0,2,1,1,1,1,2,2,0,2,0,1,1,1,1,0,1,0,1,1,2,2,1,1,2,1,0,2,0,0,1,0,1,2,1,1,0,1,0,2,0,1,0,0,2,0,0,1,1,1,1,0,0,2,2,1,0,1,1,2,1,2,1,2,2,1,0,0,1,1,0,1,0,2,1,2,0,1,1,2,1,1,2,2,2,0,2,0,0,0,1,0,2,1,1,2,1,1,1,1,2,2,0,0,0,2,2,0,0,2,0,1,0,2,1,0,1,2,0,2,0,0,1,1,2,2,1,2,2,0,2,0,0,1,2,1,0,0,0,0,2,0,1,0,0,2,0,1,0,2,0,1,2,2,1,0,2,2,2,1,1,1,2,2,1,2,2,2,1,2,0,1,0,2,2,0,0,2,2,2,0,0,1,1,2,2,2,2,2,0,2,2,1,2,2,0,2,2,1,1,0,2,2,1,1,0,1,2,2,2,1,0,1,0,2,1,1,0,1,2,0,1,1,1,0,0,0,1,0,0,1,0,1,0,1,2,2,2,0,0,2,1,1,0,1,2,1,1,2,0,0,1,1,0,2,0,0,0,1,2,2,0,0,1,0,2,1,0,2,1,2,1,0,1,2,2,1,1,0,1,2,2,0,1,1,0,2,0,0,1,1,0,2,0,0,0,1,2,0,0,0,1,1,2,1,2,0,1,2,2,1,2,1,2,2,2,2,1,2,1,0,1,0,0,0,2,2,0,1,2,0,2,2,0,0,2,0,1,1,0,2,2,0,0,2,2,2,0,0,1,1,2,0,2,2,1,0,0,0,2,2,2,0,1,2,1,1,0,1,1,0,1,1,1,2,1,0,2,1,2,2,0,1,0,1,0,0,0,2,2,2,1,2,1,0,0,2,0,1,0,0,1,2,1,0,0,2,0,2,0,2,2,1,2,2,2,1,1,1,1,1,2,1,1,2,2,2,1,0,2,2,0,0,1,1,0,0,0,0,2,2,2,2,2,0,2,2,1,2,0,2,1,2,0,1,1,2,2,2,0,2,0,0,0,0,1,0,1,2,2,2,0,0,1,2,0,1,2,2,2,1,0,0,1,0,2,0,0,2,2,0,0,0,2,2,1,1,0,2,0,0,1,0,2,2,1,1]
	let volumesTrain = [1199.88,381.30,603.84,4147.38,115890.76,59587.62,68647.76,82006.60,78539.76,74923.73,108928.78,58943.13,43526.29,70379.86,4521.62,62833.91,58299.77,68910.35,74110.78,57374.36,55665.27,48333.78,76649.12,108970.77,46252.64,4917.21,57456.10,47788.05,32752.95,57952.84,40664.66,46024.00,47130.76,94418.98,50119.06,27759.78,13352.53,30055.50,86107.92,52052.44,48046.41,37381.95,45330.98,30329.06,24316.92,57895.46,41031.02,9389.57,61571.56,55831.61,50292.29,46290.93,30688.17,42120.29,31463.16,38488.52,45725.16,28943.42,6134.92,26441.96,34073.65,54463.13,34587.33,56140.51,48044.45,38295.49,22561.36,30872.70,42740.06,4765.43,45772.55,39053.57,43375.57,28054.35,22554.54,26052.01,35458.76,60413.58,48815.00,51856.23,5346.63,43931.13,40679.54,65279.26,150188.93,97267.73,76838.09,60794.82,70063.66,85087.48,97553.07,4663.42,56931.84,58629.11,74970.25,63529.08,65755.92,41858.16,41493.06,84952.33,90748.28,64909.61,5550.73,70132.49,59818.85,56237.90,41368.23,84734.21,75923.83,73940.16,46085.25,64448.30,43678.70,603.54,6707.94,37900.00,46212.39,69590.92,53998.23,63246.03,45953.90,32973.79,43177.87,55353.61,78148.19,7487.06,87221.84,121950.10,92733.59,90001.60,56368.78,62620.23,73491.87,49347.11,58253.75,43830.25,17589.01,35379.15,43837.60,67059.29,61822.45,64991.51,55601.61,47266.72,38440.03,39157.92,70683.43,13918.75,43991.23,51876.56,57676.61,48101.11,28420.83,30549.48,50095.25,41874.89,39596.02,60866.33,16553.03,50130.39,22298.22,23212.00,34025.76,48674.74,32811.99,51959.69,48240.07,43648.03,29043.85,11820.40,52825.28,42205.28,41415.10,48760.71,48797.74,22368.91,23284.04,47414.53,62134.75,114584.45,9436.80,70038.82,50386.99,35952.20,38481.57,60951.67,80811.01,94440.56,74872.60,70657.77,67339.23,12416.32,36285.64,64566.42,74115.63,93016.98,143741.52,122618.19,101431.20,65547.17,108976.33,61681.91,11616.86,78469.74,102196.35,75691.88,59116.34,43596.84,81300.67,115221.40,149019.78,93009.56,88423.01,9181.27,75577.45,81645.73,82961.50,113581.50,93266.57,181005.24,85297.02,64910.69,55329.01,115463.46,808.46,4202.62,127698.76,75911.01,66689.39,71283.66,42922.74,37043.09,41372.29,61626.94,79585.55,52890.67,9177.18,72610.72,49519.97,56560.82,47257.20,61834.36,114306.33,184882.47,79646.13,86045.06,76690.14,10624.63,88030.29,87033.12,119047.25,69013.83,79519.94,97806.51,148455.58,79721.74,69411.59,95356.05,13210.74,75508.50,54182.92,129993.87,120957.56,140899.88,116049.99,127139.20,132825.70,139789.95,75785.97,13450.49,118209.54,251156.13,133948.15,124477.91,102950.38,118300.92,86348.43,80157.72,70698.11,79611.30,20324.21,89368.42,135004.07,142971.68,64595.28,57978.03,88499.22,84972.20,95911.96,92621.14,231827.00,36076.27,84889.68,68742.28,82718.27,78056.65,80784.33,92080.73,66681.33,98757.31,84363.67,138597.53,13141.53,115499.86,97154.18,89561.08,85870.03,63768.09,73735.47,79398.15,88813.26,85743.63,60758.04,28557.53,79659.77,80948.20,58166.70,134019.43,169375.02,91881.20,83310.67,109423.20,66060.83,83055.36,15748.20,85086.11,64221.06,81035.91,82649.71,78192.49,44399.23,55235.02,66987.35,71656.73,84749.23,556.95,15034.66,81914.81,73405.40,83245.09,52601.05,102771.42,77986.69,70421.62,66580.40,52392.65,44476.94,14959.86,48564.47,62581.62,59789.36,83537.46,87400.53,63813.77,50105.47,39050.38,67857.93,55122.44,21717.85,60975.54,47415.61,47382.41,47409.85,41314.08,54258.01,54201.00,71228.40,44283.14,40831.88,18072.00,69906.42,41156.71,56375.03,82848.68,82616.34,51649.70,91764.13,58912.25,124882.13,78229.04,19221.15,72744.48,66984.75,104656.63,132230.78,55361.51,58255.64,86310.80,54064.03,55130.45,52486.01,11768.98,68578.91,42600.35,36812.87,57649.93,85324.62,77263.92,70181.67,74542.74,69709.90,69806.11,8609.91,89586.34,64329.54,99842.78,147332.00,80082.20,89437.44,114269.81,166657.17,116979.86,354347.24,20078.09,203017.59,202100.88,126542.24,217136.04,161630.89,111996.22,104780.77,86547.15,135377.62,112663.09,15905.66,73535.38,94160.73,81234.66,67587.37,75889.10,91317.79,70459.62,47650.20,77574.95,123251.18,21329.64,136607.59,109527.28,78466.00,87717.54,86921.02,108522.39,80679.62,87771.97,79541.30,95228.04,560.66,23251.49,68712.44,89878.17,168778.87,204208.17,126966.10,86625.80,116061.13,107820.37,96613.24,82222.26,18571.45,90788.79,77152.19,71708.26,56172.18,43044.57,43703.47,64123.87,58210.59,53807.52,70136.48,12493.12,47153.93,34761.17,31572.64,48181.40,41126.36,46777.82,51639.57,48499.86,34012.24,35923.71,26600.60,47340.46,61034.04,82796.26,46148.09,50112.86,47977.55,47852.92,152452.51,88397.26,101344.52,14315.00,53998.43,73602.78,44849.79,53953.18,50837.35,57117.43,52329.35,84343.75,75753.94,73396.74,17411.00,69329.09,74587.88,53814.64,52734.90,55266.10,48239.37,46114.35,42110.71,52480.57,57039.34,33554.72,54099.41,53411.75,56850.35,46745.13,37007.88,52462.54,51014.59,44655.83,49371.27,42068.10,16417.16,26681.06,32652.28,40288.35,48645.52,49904.65,54410.77,59025.64,34664.65,40544.83,49249.66,12221.50,123048.80,65069.31,50651.66,49048.26,30440.40,32094.28,65429.15,44855.85,43204.71,40725.08,17017.89,34461.92,30906.47,29847.24,78003.52,84534.08,58349.05,48699.57,84113.42,33594.57,49879.99,929.14,14652.09,39776.84,43372.26,33511.53,46381.22,66244.87,30508.98,30825.05,46796.49,52125.66,79877.54,63401.16,54917.37,46160.25,55177.08,89237.83,52933.16,53471.28,55808.44,43053.33,82512.90,35467.88,72331.79,39099.24,51798.44,53628.10,51428.93,68538.64,52119.35,27626.93,31226.57,36853.83,40217.50,48464.43,62124.49,61056.35,43973.90,31478.12,39267.63,44687.66,46368.28,43336.09,35930.93,31604.48,34129.37,25590.57,25515.68,54442.09,44661.37,65171.50,37237.98,44490.10,22504.97,25705.07,37829.37,28768.85,77455.15,46289.38,62146.99,50715.88,33811.59,31902.22,51724.32,49917.85,39612.04,42153.51,41379.77,65927.87,29716.99,36163.71,40125.28,49161.05,44956.63,37574.05,58927.69,114203.37,45580.82,43752.60,58571.21,38253.46,38425.92,37692.68,44233.57,28889.19,26017.93,50869.52,39955.98,51629.18,37473.92,31949.86,43104.48,25020.05,29305.70,35848.50,37713.92,27004.20,35192.54,31684.84,19135.51,27158.58,22569.88,28792.21,45853.33,39498.87,30352.29,34937.99,19604.46,18340.46,27662.07,35491.41,691.21,20839.95,51784.11,38880.37,54836.50,32952.73,22724.39,50729.17,37296.43,33943.29,34910.87,32640.88,33056.87,21936.05,20602.35,27562.08,29324.08,31685.72,42330.33,88860.89,90471.33,44279.52,91904.75,18860.76,49232.40,69830.16,53020.87,42154.26,26129.49,21430.66,36855.24,34574.44,35794.68,32081.10,16887.33,64703.95,32532.34,22405.16,51060.62,64880.29,34428.16,62357.29,44975.16,26556.85,17732.08,14170.37,34010.13,38095.19,28471.87,47245.99,43845.92,18042.05,33439.29,62347.68,53785.94,43560.73,25554.37,120476.29,56574.57,29361.25,46229.44,73945.63,61743.09,57782.65,50940.61,61964.68,30363.13,18015.95,39677.26,63994.11,55583.06,67392.58,71962.93,59018.76,24034.36,32791.82,46945.45,46015.54,33564.76,88120.76,37189.38,45408.00,29067.18,30653.33,39426.24,59454.94,40828.87,56195.12,54614.43,49971.62,23041.61,41874.91,58949.26,36772.28,40947.20,48645.12,56271.06,37073.53,33394.67,44641.87,28725.00,42192.74,60849.32,37396.54,42375.04,17891.66,22771.09,63560.44,57751.01,41342.27,36807.01,1394.64,32014.30,24026.35,15805.44,19988.49,54243.49,35788.85,40877.35,59316.27,46664.01,20291.42,26703.61,63403.18,63037.12,66650.25,57083.12,56086.67,51453.65,35321.18,100201.50,60778.46,1521.53,20482.91,49381.51,45025.18,41987.85,35454.97,1228.93,40811.95,52427.59,38161.20,41882.10,61137.38,40831.41,48153.35,68113.81,67060.16,57202.70,807.36,40888.15,28373.51,34878.29,30705.38,30800.98,25092.55,23910.71,21287.15,17295.91,15144.23,467.08,500.42,29515.57,50647.67,41109.47,64112.29,37180.01,44325.97,42230.77,40191.40,49708.09,52291.02,1132.25,38815.40,33110.20,59488.23,55297.08,44865.10,39972.40,40617.55,39991.00,35466.60,29001.76,658.78,44033.59,37427.64,26401.33,54620.91,65306.03,36868.53,44071.43,32123.56,37787.33,42227.18,660.37,39029.73,27455.01,32269.57,21427.67,34078.29,22326.72,23997.87,64861.59,55044.52,31621.28,699.98,27946.72,36664.06,32152.60,26969.04,27113.84,39795.33,40872.22,29458.25,25838.11,46268.79,879.63,81110.03,43300.30,37241.34,34759.62,38149.85,35002.03,41018.46,26123.54,38768.38,28681.58,913.46,24990.01,27690.35,33787.64,25533.83,25673.52,25055.06,48227.04,40241.32,25632.86,37389.66,1665.02,28126.95,31130.71,25439.84,23476.15,17193.42,19957.05,21516.59,23710.90,42910.66,37845.44,1968.86,26739.95,19464.08,18706.94,27219.43,39407.21,32041.58,30776.06,28259.12,26720.69,27505.15,1297.56,32258.83,31722.97,27229.99,25062.22,23396.80,19339.88,52342.02,34552.16,36722.21,46185.51,691.74,682.17,44478.13,30018.32,22277.24,19847.24,31821.43,24311.42,26359.75,25428.85,52157.37,26622.78,1030.00,47445.99,39164.51,19377.24,19225.67,30585.26,33911.28,37919.61,27562.96,36230.45,38657.78,902.33,23571.89,35071.97,29397.09,23973.87,24622.94,26732.40,38560.67,28715.49,31306.66,26375.32,720.93,17783.07,22979.21,36204.87,52105.42,59487.64,41218.25,46140.31,28886.49,30270.21,41646.34,1001.65,60121.16,48257.64,43223.48,43671.00,26215.17,25531.22,39692.41,48296.91,42582.31,37665.69,838.96,44669.48,36288.42,32894.84,32760.19,45438.47,59550.53,51941.18,59034.97,47133.41,38567.77,752.79,53895.82,50186.74,68806.68,48515.25,57851.61,53742.32,45190.84,49435.55,41569.94,77909.39,661.63,40358.16,38305.67,19220.50,20107.29,37747.07,48352.91,43252.48,44716.77,40467.40,40323.41,727.99,39814.84,32396.01,35300.64,63715.25,60644.46,38906.28,38215.03,37053.92,32439.45,33104.88,526.72,31433.64,40465.06,37173.33,25243.65,27568.13,35987.25,32620.86,39044.08,25189.02,51779.34,966.68,628.17,29349.69,30286.22,35305.73,40301.02,33484.54,33087.42,42399.44,30255.95,27764.72,20621.50,849.78,28245.81,28451.96,20074.30,16096.55,10939.50,17406.83,23123.41,15354.77,15390.66,48712.40,1602.30,29004.07,19098.07,15627.41,90748.03,27557.95,26641.43,20116.52,20772.60,19240.72,6515.35,720.35,16213.69,13856.60,11951.54,10342.70,9443.50,7776.90,5743.93,13827.22,8877.17,12148.88,726.96,9099.03,9739.44,7661.24,10592.39,8987.88,11926.56,14271.59,13259.78,11787.61,7714.82,655.75,8213.50,10132.78,11790.56,46478.96,47700.82,38721.80,26411.24,23844.99,70580.89,117380.95,1082.32,61071.82,34531.11,49371.92,61693.11,101693.97,94504.86,67480.60,91983.56,73980.19,67758.44,868.46,44840.07,38912.15,49094.36,48489.55,44004.79,68378.79,95145.45,55365.94,45956.89,40989.24,779.13,35920.86,33922.93,40040.91,44492.98,29796.04,24628.80,66762.21,61369.61,94137.34,101543.83,506.52,82343.85,42822.35,40117.53,64647.80,62725.62,42629.37,44097.39,45964.30,38874.37,33222.36,1001.13,297.59,29991.77,23741.68,35156.46,29406.94,29519.55,30490.66,36553.80,31869.84,38901.42,28989.43,518.46,59402.22,38338.65,21999.92,26385.75,35235.21,34137.99,27480.17,29755.44,22713.44,22171.57,646.46,27901.93,19644.43,29336.44,24938.84,20826.25,17608.34,19476.53,22735.59,40405.11,29544.92,1043.22,23968.26,29607.19,25260.47,17920.80,19867.33,23131.98,25264.41,35310.24,18665.53,47968.05,753.42,24759.83,23250.60,24954.61,29479.59,25773.99,21753.50,20777.87,19565.99,25690.22,64042.73,1276.70,50207.17,36205.14,31103.88,23943.16,33657.94,62224.18,38102.96,28838.74,31500.99,32561.96,1879.82,23174.57,19445.83,16718.16,34742.84,32962.53,24775.11,26455.25,34730.36,30979.74,23187.56,970.75,38066.88,26921.00,24461.00,27048.74,21740.06,28568.37,18814.25,22454.47,19893.74,23432.30,1343.52,35997.68,20022.60,17302.60,17179.85,33192.89,29349.53,32364.55,20089.29,30084.21,19509.29,1528.99,13525.08,25507.06,105383.63,109890.12,61054.25,39768.55,41770.84,37615.48,50178.43,34067.01,787.41,1429.86,40073.62,54696.60,33276.67,17292.45,18281.60,29057.19,24242.22,23307.53,22619.23,24611.23,2317.80,19168.90,25549.57,29563.85,41262.10,48224.15,49636.08,48912.29,15422.89,14371.43,19918.13,1881.72,22238.06,17217.47,22795.78,46297.17,39682.40,23822.54,25256.59,39905.06,23074.18,27453.01,1972.97,36623.61,74022.42,86948.97,85804.73,76583.72,37884.32,69630.51,88752.00,37054.94,65577.44,1664.30,65859.20,52301.75,49136.99,49648.18,46664.78,28414.32,49652.14,51886.76,31470.55,33880.86,1362.09,70379.99,44727.49,31868.23,27835.13,45692.96,74143.94,48679.65,36624.11,33942.22,22657.32,1812.55,31568.46,36756.07,30334.99,41597.08,30467.76,39835.24,31791.63,63289.25,47895.48,51554.56,2580.41,32147.70,34556.05,50484.41,104169.44,57445.32,43101.04,61276.68,155930.14,173894.82,95795.20,2282.81,69642.07,84512.53,90962.26,109561.03,96815.90,66512.22,63534.35,51469.49,38884.79,52182.36,1972.96,78442.13,109246.04,87506.46,56321.85,54245.59,72517.57,81922.42,97219.44,84942.67,80283.31,573.61,1403.70,56546.93,47331.89,38834.28,40467.95,47624.37,43475.38,37873.35,27167.46,43809.77,29401.02,1276.75,29021.93,32536.36,39515.35,41727.63,42990.44,33802.31,39924.74,65153.67,76705.38,69173.39,1804.77,51207.25,39427.15,42633.08,26772.90,17568.22,33234.72,54451.84,38174.45,51758.14,29000.58,1473.68,24085.39,37243.31,32298.92,47355.71,34059.64,27550.33,27692.45,26271.65,41687.51,28402.77,1511.77,42110.55,35532.69,26834.31,17130.29,19545.40,44740.24,47998.37,43943.88,33970.96,58799.64,1675.61,27637.87,23984.67,39835.72,28915.41,31953.82,34511.16,30280.33,23621.53,18047.65,28971.40,2503.61,22914.32,24250.24,44826.28,25088.49,20544.17,22049.27,31937.23,94007.34,60783.89,67930.85,1891.49,43882.92,34473.60,31544.21,55865.48,43479.58,26243.38,30488.28,26476.33,21907.61,34676.10,1399.19,52202.07,35452.65,55038.70,39137.94,50405.28,21339.33,27840.73,29810.66,32773.06,34733.59,1207.83,29656.94,31353.18,26627.88,34286.45,30448.67,34651.82,63897.45,32714.38,90748.21,162588.58,228.10,1763.01,93833.54,80174.21,64158.46,55241.78,54376.02,43594.81,28923.06,27894.37,45894.45,45935.87,1440.25,37336.17,39117.47,62107.28,29469.48,34422.02,44888.05,40366.62,26810.11,33468.46,46087.41,2822.29,20902.29,27009.03,43017.69,43556.06,32466.23,58418.78,126603.14,50449.89,67890.20,119645.73,1913.39,65722.39,92452.87,56933.98,60745.30,46989.43,60769.34,46330.25,33149.47,83153.70,59306.67,3254.70,48189.08,31498.68,29856.89,46621.88,49723.76,30093.09,42288.60,27609.87,29561.98,26395.77,2754.15,43863.99,53865.06,95636.65,55509.04,32132.06,19467.17,39137.45,68051.99,43629.49,27492.04,4968.48,36259.76,33642.70,26848.98,31387.10,29605.91,25954.45,16792.38,31951.48,68428.50,29987.97,2621.24,38331.08,54635.69,91171.68,112622.64,64239.51,82406.77,54810.03,38131.49,31159.75,120399.12,1254.29,84816.29,51991.07,70897.73,38294.74,70676.88,38896.63,36494.68,29080.55,48165.94,41687.52,1779.60,25521.15,31130.48,53973.54,74584.85,53864.06,60626.74,45552.02,28578.06,45690.91,50892.13,350.69,2331.95,53308.17,64870.41,64949.70,43966.11,43600.84,43408.47,59573.08,62422.39,61008.06,79344.35,3982.39,47038.48,57657.20,60023.99,70261.01,70604.12,55162.58,60152.34,42181.55,24636.75,37702.08,3954.26,55796.59,54379.34,92130.34,72483.57,71155.20,36748.18,43892.20,60401.31,55154.99,38696.48,3867.34,58201.86,43782.94,45422.20,77537.31,116968.86,86783.44,79942.41,261505.60,402201.67,136910.13,3886.63,139916.14,227276.92,150089.92,137127.63,199020.87,219298.32,128913.66,119115.99,164674.21,151138.00,4544.47,132155.73,83026.55,82914.96,93159.69,63311.62,118889.54,72337.59,97500.75,149299.90,104080.27,3545.00,72990.86,49685.35,118052.00,103585.16,76059.14,61094.87,104674.62,45470.29,73868.66,96415.47,4093.95,69068.62,61571.38,125009.85,54126.50,49488.54,45664.86,90149.49,60109.71,61486.37,102773.56,4411.78,60182.11,43874.42,50522.61,65441.33,46302.75,183546.88,206277.21,91468.81,59002.08,90126.06,4292.62,84418.51,76480.76,105925.30,147154.61,100683.79,81950.67,183865.18,168807.25,86522.78,129565.37]
	closePrices = [38468.35,38525.16,37728.95,39690,36552.97,36013.77,35472.39,34038.4,30076.31,31017.1,29103.94,29029.75,29287.05,30086.74,31328.89,29874.01,30444.93,28715.32,30319.23,29201.01,29445.06,30293.94,29109.15,29654.58,29542.15,29201.35,28629.8,29031.33,29468.1,31734.22,31801.04,29805.83,30452.62,29700.21,29864.04,29919.21,31373.1,31125.33,30204.77,30109.93,29091.88,28424.7,26574.53,22487.41,22136.41,22583.72,20401.31,20468.81,18970.79,20574,20573.89,20723.52,19987.99,21110.13,21237.69,21491.19,21038.07,20742.56,20281.29,20123.01,19942.21,19279.8,19252.81,19315.83,20236.71,20175.83,20564.51,21624.98,21594.75,21591.83,20862.47,19963.61,19328.75,20234.87,20588.84,20830.04,21195.6,20798.16,22432.58,23396.62,23223.3,23152.19,22684.83,22451.07,22579.68,21310.9,21254.67,22952.45,23842.93,23773.75,23643.51,23293.32,23268.01,22987.79,22818.37,22622.98,23312.42,22954.21,23174.39,23810,23149.95,23954.05,23934.39,24403.68,24441.38,24305.24,24094.82,23854.74,23342.66,23191.2,20834.39,21140.07,21515.61,21399.83,21529.12,21368.08,21559.04,20241.05,20037.6,19555.61,20285.73,19811.66,20050.02,20131.46,19951.86,19831.9,20000.3,19796.84,18790.61,19292.84,19319.77,21360.11,21648.34,21826.87,22395.74,20173.57,20226.71,19701.88,19803.3,20113.62,19416.18,19537.02,18875,18461.36,19401.63,19289.91,18920.5,18807.38,19227.82,19079.13,19412.82,19591.51,19422.61,19310.95,19056.8,19629.08,20337.82,20158.26,19960.67,19530.09,19417.96,19439.02,19131.87,19060,19155.53,19375.13,19176.93,19069.39,19262.98,19549.86,19327.44,19123.97,19041.92,19164.37,19204.35,19570.4,19329.72,20080.07,20771.59,20295.11,20591.84,20809.67,20627.48,20490.74,20483.62,20151.84,20207.82,21148.52,21299.37,20905.58,20591.13,18547.23,15922.81,17601.15,17070.31,16812.08,16329.85,16619.46,16900.57,16662.76,16692.56,16700.45,16700.68,16280.23,15781.29,16226.94,16603.11,16598.95,16522.14,16458.57,16428.78,16212.91,16442.53,17163.64,16977.37,17092.74,16885.2,17105.7,16966.35,17088.96,16836.64,17224.1,17128.56,17127.49,17085.05,17209.83,17774.7,17803.15,17356.34,16632.12,16776.52,16738.21,16438.88,16895.56,16824.67,16821.43,16778.5,16836.12,16832.11,16919.39,16706.36,16547.31,16633.47,16607.48,16542.4,16616.75,16672.87,16675.18,16850.36,16831.85,16950.65,16943.57,17127.83,17178.26,17440.66,17943.26,18846.62,19930.01,20954.92,20871.5,21185.65,21134.81,20677.47,21071.59,22667.21,22783.55,22707.88,22916.45,22632.89,23060.94,23009.65,23074.16,23022.6,23742.3,22826.15,23125.13,23732.66,23488.94,23431.9,23326.84,22932.91,22762.52,22963,21796.35,21625.19,21862.55,21783.54,21773.97,22199.84,24324.05,23517.72,24569.97,24631.95,24271.76,24842.2,24452.16,24182.21,23940.2,23185.29,23157.07,23554.85,23492.09,23141.57,23628.97,23465.32,22354.34,22346.57,22430.24,22410,22197.96,21705.44,20362.22,20150.69,20455.73,21997.11,24113.48,24670.41,24285.66,24998.78,27395.13,26907.49,27972.87,27717.01,28105.47,27250.97,28295.41,27454.47,27462.95,27968.05,27124.91,27261.07,28348.6,28028.53,28465.36,28452.73,28171.87,27800,28165.47,28170.01,28033.82,27906.33,27938.38,28323.76,29637.34,30200.42,29888.07,30373.84,30466.93,30295.09,30304.65,29430.27,30380.01,28797.1,28243.65,27262.84,27816.85,27590.6,27510.93,28300.79,28415.29,29472.77,29311.7,29230.45,29233.21,28068.26,28669.86,29026.16,28838.16,29505.61,28848.2,28430.1,27668.79,27628.27,27598.75,26968.62,26795.01,26775.28,26917.62,27162.14,27033.84,27405.61,26821.28,26880.26,27102.43,26747.78,26849.27,27219.61,26329.01,26473.79,26705.92,26854.27,28065,27736.4,27694.4,27210.35,26817.93,27242.59,27069.22,27115.21,25728.2,27230.08,26339.34,26498.61,26477.81,25841.21,25925.55,25905.19,25934.25,25128.6,25598.49,26345,26516.99,26339.97,26844.35,28307.99,29993.89,29884.92,30688.5,30527.43,30462.66,30267.99,30692.44,30077.41,30447.31,30472,30585.9,30617.03,31156.2,30903.99]
	actions = actionsTrain.slice(0, 429)
	volumes = [38812.24104,53200.92628,40316.45358,62574.61736,88722.43355,68437.80187,34281.70682,72445.64344,191876.926428,165532.00311,207063.739278,204507.263138,97872.36957,51095.87863,46275.66912,73082.19658,56724.13307,59749.15799,67877.36415,60517.25325,20987.13124,36158.98748,63901.49932,59442.96036,59537.38659,94581.65463,90998.5201,34479.35127,27567.34764,96785.9476,62433.11632,103395.63382,56961.42928,54067.44727,25617.90113,23139.9281,68836.92456,110674.51658,68542.61276,46291.1865,76204.2498,65901.39895,92474.598809,254611.034966,187201.64671,200774.493467,99673.59429,86694.33663,196441.655524,128320.87595,109028.94154,104371.0749,92133.97938,83127.08716,77430.36622,51431.67794,53278.10464,64475.0013,63801.0832,77309.04379,93846.64806,111844.59494,46180.3021,51087.46631,74814.04601,96041.13756,82439.5808,85014.58261,403081.57349,178417.84468,192188.21556,137535.40724,139506.45862,209250.24888,174809.21696,143343.3049,121011.67393,118229.4525,239942.73132,263770.76574,238762.17094,184817.68191,171598.43966,122137.77375,115189.67277,180344.76643,177817.24326,210971.19796,236029.0741,198298.50623,151060.13211,127743.32483,144210.16219,158073.28225,145948.80995,154854.67016,175251.69749,83911.80307,88890.00877,170958.44152,143182.50858,208916.54953,249759.79557,174207.5704,152852.25435,151206.14473,242539.54758,179324.94821,210668.68766,144185.97011,283995.87747,183041.68363,159200.6841,222222.04526,200967.77164,174383.22046,169915.78301,273811.61955,162582.46032,139307.95976,210509.49545,256634.35529,276946.60765,245289.97263,245986.6033,146639.03204,145588.77893,222543.01057,356315.05718,287394.7788,262813.28273,428919.74652,307997.33504,280702.55149,395395.61828,431915.03333,340826.40151,333069.76076,283791.07064,179350.24338,254217.46904,380512.40306,324098.3286,385034.10021,379321.72111,385886.91829,239496.56746,191191.4492,439239.21943,593260.74161,521385.45547,406424.93256,444322.9534,165625.13959,206812.47032,293585.75212,327012.00127,312239.75224,320122.1702,220874.83913,102480.09842,113900.82681,212509.09849,243473.84286,213826.26731,399756.68337,351634.32601,113847.64232,131894.61885,222813.87634,260313.07848,186137.29538,223530.13068,269310.75769,110403.90837,167057.20184,256168.14467,326370.67061,380492.69576,328643.57791,287039.94569,254881.77755,192795.60886,303567.61628,279932.43771,373716.27299,319185.1544,453694.39165,245621.98525,230036.97217,386977.60337,760705.362783,731926.929729,608448.36432,393552.86492,167819.96035,184960.78846,380210.7775,282461.84391,261493.40809,228038.97873,214224.18184,104963.15558,154842.13478,324096.997753,239548.06623,264927.70408,206565.92346,182089.49533,181804.81666,162025.47607,252695.40367,248106.25009,303019.80719,232818.18218,202372.2062,154542.57306,178619.13387,233703.29225,218730.76883,220657.41334,236417.97804,238422.06465,140573.97937,155286.47871,226227.49694,284462.9139,266681.22209,223701.96882,253379.04116,144825.66684,112619.31646,179094.28305,248808.92324,156810.96362,176044.27235,161612.00947,100224.29096,125441.07202,124564.00656,173749.58616,193037.56577,160998.47158,164916.31174,114490.42864,96925.41374,121888.57191,159541.53733,220362.18862,163473.56641,207401.28415,104526.5688,135155.89695,266211.52723,221382.42581,262221.60653,454568.32178,368615.87823,393913.74951,178542.22549,293078.08262,275407.74409,350916.01949,251385.84925,338079.13659,346445.48432,253577.75286,293588.37938,293158.78254,346042.83223,288924.43581,280833.86315,148115.71085,295688.79204,302405.90121,264649.34909,310790.42271,364177.20751,332571.02904,166126.47295,209251.33917,265371.6069,280056.30717,402894.6955,338591.94247,177021.58433,204435.65163,295730.76791,361958.40109,375669.16111,450080.68366,496813.21376,216917.25213,300395.99542,346938.56997,376000.82868,379425.75365,398400.45437,343582.57453,191311.8101,202323.73623,283706.0859,264140.99894,315287.41737,239315.45219,319954.19785,121257.38132,154841.75786,203751.82957,292519.80912,301460.57272,443658.28584,618456.4671,427831.82133,430944.94288,687889.31259,699360.93423,581450.72984,439421.32998,624460.68091,371238.97174,372066.99054,477378.23373,420929.7422,224113.41296,128649.60818,86242.06544,50844.08102,49671.70353,88039.46898,78602.44341,89486.16008,98865.43256,78198.12139,30238.44753,37365.65692,79180.01405,49722.55691,60737.64732,40118.94963,24762.09387,19479.96735,32531.16101,67754.0622,67990.07621,62049.48451,51934.11731,75984.19452,25429.81247,26431.99322,56441.81127,62004.89434,86575.48656,76879.09372,77684.7679,36023.69686,34812.09581,53111.56874,52325.14637,129228.40403,95430.82431,54298.16578,20466.83058,39752.5372,64433.65958,50824.5224,64615.79213,42575.47501,58415.83048,49249.28459,30003.41028,68244.36179,40113.31069,71155.11355,47635.31365,67207.93494,22814.90421,21594.8036,40430.08333,33270.45451,42958.97785,49198.65143,28754.13544,14434.54718,21347.87279,26458.83828,38700.83858,54393.0657,37435.44895,35061.18713,15095.6867,43916.00855,42385.41945,32686.75371,46588.80573,39217.8088,36380.90269,16595.34117,19258.41049,65805.60305,68392.60438,59619.44364,31075.51083,27934.7097,64944.60108,30014.29595,29900.50893,41065.60853,45077.31608,48664.86063,51596.91662,27842.2195,21538.31022,35872.65974,69666.95525,108926.40412,59054.5646,73931.89635,30513.30135,30223.44801,45180.41489,42699.64157,40463.51937,36330.62903,89419.07618,17501.75075,23286.41019,43761.64311,21096.70171]
	trades = convertActionsToTrades(actions, closePrices)
    minMaxStep = [0, closePrices.length - 1]


	async function getMetric(metric_name: String): Promise<Array<number>> {
		type Metric = { key: String, value: number, timestamp: number, step: number }
		const values = await mlflowGet(`metrics/get-history?run_id=${id}&metric_key=${metric_name}`)
		if (!values.correct) {
			errors.push(`Failed getting metric ${metric_name}: ${values.error}`)
			return []
		}
		return values.metrics.sort((v: Metric) => v.step).map((v: Metric) => v.value)
	}

	async function getDatafile(param_data: any, param_name: String) {
		type Param = { key: String, value: String }
		const filename = param_data.run.data.params.filter((p: Param) => p.key == param_name).map((p: Param) => p.value)[0]
		if (!filename) {
			errors.push(`Failed loading datafile ${param_name}`)
			return { close: [], volume: [] }
		}
		const data = await fetch(`/data/${filename}?url`)
			.then(response => response.json())
			.then(data => ({
					close: Object.keys(data.close).sort().map(key => data.close[key]),
					volume: Object.keys(data.volume).sort().map(key => data.volume[key]),
				})
			).catch((error) => {
				errors.push(`Failed loading datafile ${param_name}: ${error}`)
				return { close: [], volume: [] }
			})
		return data
	}

	function convertActionsToTrades(actions: Array<number>, closePrices: Array<number>){
        const trades = []
        let trade: any = {}
        for (let i = 0; i < actions.length; i++) {
            if (actions[i] == 1 && !('buy_step' in trade)) {
                trade['buy_step'] = i
                trade['buy_price'] = closePrices[i]
                continue
            }
            if (actions[i] == 2 && ('buy_step' in trade)) {
                trade['sell_step'] = i
                trade['sell_price'] = closePrices[i]
                trade['profit'] = trade['sell_price'] - trade['buy_price']
                trades.push(trade)
                trade = {}
                continue
            }
        }
        if (('buy_step' in trade) && !('sell_step' in trade)) {
            const i = actions.length - 1
            trade['sell_step'] = i
            trade['sell_price'] = closePrices[i]
            trade['profit'] = trade['sell_price'] - trade['buy_price']
            trades.push(trade)
        }
        return trades        
    }


	onMount(async () => {
		isLoading = false
		// if (id.length == 0) {
		// 	alert(`Failed getting run info: Parameter id is required`)
		// 	isLoading = false
		// 	return
		// }
		// const data = await mlflowGet(`runs/get?run_id=${id}`)
		// if (!data.correct) {
		// 	alert(`Failed getting run info: ${data.error}`)
		// 	isLoading = false
		// 	return
		// }
		// let datafile
		// if (stage == 'train') {
		// 	actions = await getMetric('train/action')
		// 	datafile = await getDatafile(data, 'train_data')
		// } else {
		// 	actions = await getMetric('test/action')
		// 	datafile = await getDatafile(data, 'test_data')
		// }
		// closePrices = datafile.close
		// volumes = datafile.volume
		// trades = convertActionsToTrades(actions, closePrices)
		// minMaxStep = [0, closePrices.length - 1]
		// isLoading = false
	})
	
</script>

<svelte:head>
	<title>Run</title>
	<meta name="description" content="About this app" />
</svelte:head>

<div>
	<h2>Run {id} ({stage})</h2>
	{#if isLoading}
		<div class="loader"><img src={loader} alt='loader'/></div>
	{:else}
		<div class="errors">
			<Errors
				actions={actions}
				closePrices={closePrices}
				volumes={volumes}
				errors={errors}/>
		</div>
		<div class="data">
			<div>
				<Metrics
					bind:minMaxStep={minMaxStep}
					actions={actions}
					closePrices={closePrices}
					volumes={volumes}
					trades={trades}/>
			</div>
			<div>
				<Trades
					bind:minMaxStep={minMaxStep}
					actions={actions}
					closePrices={closePrices}
					volumes={volumes}
					trades={trades}/>
			</div>
		</div>
	{/if}
</div>

<style>
	h2 {
		text-align: center;
	}
	.loader {
		min-height: 30vh;
		display: flex;
		justify-content: center;
		align-items: center;
	}
	.loader img {
		height: 10vh;
	}
	.errors, .data {
		margin: auto;
		max-width: 600px;
	}
	.data {
		display: grid;
		grid-template-columns: 1fr;
	}
	@media only screen and (min-width: 1300px) {
		.data {
			max-width: 1200px;
			grid-template-columns: 1fr 1fr;
			grid-gap: 25px;
		}
	}
</style>
